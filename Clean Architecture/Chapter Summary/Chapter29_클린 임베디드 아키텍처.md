# 29장 클린 임베디드 아키텍처

- 하드웨어의 발전으로 소프트웨어도 개선되어야 한다.
- 임베디드 코드를 구조화 할 수 있어야 소프트웨어 의존성을 관리할 수 있다.
- 펌웨어는 작게 소프트웨어는 많이..
- 예시) 통시장비에서의 메세지 처리 코드를 UART 하드웨어와 상호작용하는 파일내 구현되어 펌웨어가 되어버림
  > 임베디드 소프트웨어 아키텍처를 깔끔하게 유지하기 위해서는 분리가 필요하다.

## 앱-티튜드 테스트 (앱이 동작하도록 만드는 것)

- 왜 잠재적인 임베디드 소프트웨어는 그렇게도 많이 펌웨어로 변하는가?

```
"먼저 동작하게 만들어라."
"그리고 올바르게 만들어라."
"그리고 빠르게 만들어라."
                            by Kent Beck
```

- 1번, 3번만 염두해 두고 만드는 상황이 다반사이고 이것은 앱-티튜드 테스트만을 통과한 것이지 클린 임베디드 아키텍처를 가진다고 말하기는 어렵다.

## 타깃-하드웨어 병목현상

- 임베디드가 아니면 다루지 않아도 되었을 특수한 환경이 많다.
- 하드웨어 자체의 결함이 있을 가능성이 높다
- 그래서 타깃-하드웨어 병목현상이라는 특정 환경에서만 테스트해보게 되는 상황이 발생한다.

> 클린 임베디드 아키텍처는 테스트하기 쉬운 임베디드 아키텍처다

```
하드웨어 추상화 계층(HAL)
운영체제 추상화 계층(OSAL)
```

- '소프트웨어','펌웨어','하드웨어' 란 3개의 계층을 잘 분리하여야한다.
- 소프트웨어와 펌웨어의 경계를 분리시키기 어렵기 때문에 HAL를 두어 잘 관리해야한다.
- HAL 사용자에게 하드웨어 세부사항을 드러내지 말라 (프로세서, 운영체제(OSAL))

> 인터페이스를 통하고 대체 가능성을 높이는 방향으로 프로그래밍 하라
> DRY 원칙 : 조건부 컴파일 지시자를 반복하지 말라

## 결론

클린 임베디드 아키텍처는 제품이 장기간 생명력을 유지하는 데 도움을 준다.
모든 코드가 펌웨어가 되도록 내버려 두지 말자.
